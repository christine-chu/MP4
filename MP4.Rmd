---
title: "Don’t be Fooled by a Team’s Salary: Do MLB Payrolls Matter?"
author: "Nybria Acklin, Julia Bouzaher, Christine Chu"
date: "May 9, 2018"
output: 
  html_document:
    code_folding: hide
--- 
What determines player salary? How does a team's ranking in their division, the winning rate from the games they played, and hall of fame history by franchise affect salary? How does each teams game performance affect rankings and hall of fame status?
(include either tables or graphs you make)

hello
```{r, message=FALSE, warning=FALSE}

library(mdsr)
library(RMySQL)
library(scales)
```


```{r, message=FALSE, warning=FALSE}
db <- dbConnect_scidb(dbname = "lahman")
```


Christine 

```{r, message=FALSE, warning=FALSE}
series <- dbConnect_scidb(dbname = "lahman") 
series_df <- series %>% 
  dbGetQuery("SELECT DISTINCT ls.yearID, tf.franchName as 'Team_name', lt.teamID, sp.teamIDwinner as 'WinnerID',sp.round, sp.wins
FROM lahman.Salaries ls 
#JOIN lahman.HallOfFame hf ON hf.playerID = ls.playerID
JOIN lahman.Teams lt ON lt.teamID = ls.teamID
JOIN lahman.TeamsFranchises tf ON tf.franchID = lt.franchID
#join the series post data frame with the year ID to see the winner. 
JOIN lahman.SeriesPost sp ON ls.yearID = sp.yearID
WHERE lt.teamID = sp.teamIDwinner
#WHERE team = SeriesPost.team 
AND ls.yearID = 2015
;")

series_df
```

```{r, message=FALSE, warning=FALSE}
win_rate <- dbConnect_scidb(dbname = "lahman") 
win_ratedf <- win_rate %>% 
  dbGetQuery("SELECT DISTINCT lt.yearID, tf.franchName, W/G as Win_rate
FROM lahman.Teams lt
JOIN lahman.Salaries ls ON lt.teamID = ls.teamID
JOIN lahman.TeamsFranchises tf ON tf.franchID = lt.franchID
WHERE lt.yearID = 2015
#GROUP BY tf.franchID
;")

wr_df <- win_ratedf %>% 
  select(yearID, franchName, Win_rate )

wr_plot <- ggplot(wr_df, aes(franchName, Win_rate)) + geom_bar(stat = "identity", fill = "Green")

wr_plot +
   scale_x_discrete() +
  scale_y_continuous(expand = c(0, 0), labels = percent, breaks = c(0,0.2, 0.4, 0.6, 0.8, 1), limit = c(0,1)) +
  ggtitle("Winning rate by Franchise") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Franchise Name", y = "Winning Rate in 2015")


```




Nybria 

```{r, message=FALSE, warning=FALSE}
bb <- dbConnect_scidb(dbname = "lahman")

fame.players <- bb %>%
dbGetQuery("SELECT DISTINCT s.yearID, s.teamID, s.playerID, s.salary, tf.franchID, tf.franchName, tf.active,
t.teamID, t.franchID, hf.playerID, hf.inducted, hf.category, t.rank
FROM lahman.HallOfFame hf 
JOIN lahman.Salaries  s ON hf.playerID = s.playerID 
JOIN lahman.Teams t ON s.teamID = t.teamID 
JOIN lahman.TeamsFranchises  tf ON t.franchID = tf.franchID
WHERE hf.category = 'Player' AND s.yearID >= 2010 AND tf.active = 'Y' AND hf.inducted = 'Y' GROUP BY s.playerID
ORDER BY s.salary DESC;")

players <- bb %>%
dbGetQuery("SELECT DISTINCT s.yearID, s.teamID, s.playerID, s.salary, tf.franchID, tf.franchName, tf.active,
t.teamID, t.franchID, hf.playerID, hf.inducted, hf.category, t.rank
FROM lahman.HallOfFame hf 
JOIN lahman.Salaries  s ON hf.playerID = s.playerID 
JOIN lahman.Teams t ON s.teamID = t.teamID 
JOIN lahman.TeamsFranchises  tf ON t.franchID = tf.franchID
WHERE hf.category = 'Player' AND s.yearID >= 2010 AND tf.active = 'Y' AND hf.inducted = 'N' 
 GROUP BY tf.franchName ORDER BY s.salary, name DESC;
")

```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)


kable(head(fame.players[, 1:7]), format = "html", digits = 2, caption = "Hall of Fame: Inducted Players Between 2010-2017") %>%
  kable_styling(bootstrap_options = "striped", full_width = F)


kable(players[, 1:7], format = "html", digits = 2, caption = "Hall of Fame: Non-inducted Players Between 2010-2017") %>%
  kable_styling(bootstrap_options = "striped", full_width = F)


```



Julia
```{r}
db <- dbConnect_scidb(dbname = "lahman")

cow <- db %>% 
  dbGetQuery("SELECT DISTINCT ls.yearID, lt.Rank, lt.franchID, ls.playerID, ls.salary, tf.franchName
FROM lahman.Salaries ls 
JOIN lahman.Teams lt ON lt.teamID = ls.teamID
JOIN TeamsFranchises tf ON lt.franchID = tf.franchID
WHERE lt.yearID > 2010
GROUP BY playerID
ORDER BY Salary desc

;")

cow2 <- cow %>%
  select(Rank, franchName, salary, yearID)


cow3 <- cow2 %>%
  group_by(franchName) %>%
  mutate(avgsal = mean(salary))



library(ggthemes)
cowplot <- ggplot(cow3, aes(x=franchName, y=avgsal, col=Rank)) +
  geom_point() 

cowplot +
  geom_point(shape = 21) +
  scale_x_discrete() +
  scale_y_continuous() +
  ggtitle("Average Salary by Franchise") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Franchise Name", y = "Average Salary 2013-2018")
```

--------------------------------------------------------
This project would not have been possible without github [^1].

##Links: 
[^1]: [Link to our GitHub Repositoury](https://github.com/christine-chu/MP4)