---
title: "MP4"
author: "Christine Chu"
date: "April 25, 2018"
output: html_document
--- 


```{r}
install.packages("mdsr")
install.packages("RMySQL")
library(mdsr)
library(RMySQL)
library(scales)
```

Database for Querying 
#replace quotation with dataset we choose
```{r}
db <- dbConnect_scidb(dbname = "lahman")
```


# Individual chunks to prevent overwriting of code.
Christine 
```{r}
series <- dbConnect_scidb(dbname = "lahman") 
series_df <- series %>% 
  dbGetQuery("SELECT DISTINCT ls.yearID, tf.franchName as 'Team_name', lt.teamID, sp.teamIDwinner as 'WinnerID',sp.round, sp.wins
FROM lahman.Salaries ls 
#JOIN lahman.HallOfFame hf ON hf.playerID = ls.playerID
JOIN lahman.Teams lt ON lt.teamID = ls.teamID
JOIN lahman.TeamsFranchises tf ON tf.franchID = lt.franchID
#join the series post data frame with the year ID to see the winner. 
JOIN lahman.SeriesPost sp ON ls.yearID = sp.yearID
WHERE lt.teamID = sp.teamIDwinner
#WHERE team = SeriesPost.team 
AND ls.yearID = 2015
;")

series_df
```

```{r}
win_rate <- dbConnect_scidb(dbname = "lahman") 
win_ratedf <- win_rate %>% 
  dbGetQuery("SELECT DISTINCT lt.yearID, tf.franchName, W/G as Win_rate
FROM lahman.Teams lt
JOIN lahman.Salaries ls ON lt.teamID = ls.teamID
JOIN lahman.TeamsFranchises tf ON tf.franchID = lt.franchID
WHERE lt.yearID = 2015
#GROUP BY tf.franchID
;")

wr_df <- win_ratedf %>% 
  select(yearID, franchName, Win_rate )

wr_plot <- ggplot(wr_df, aes(franchName, Win_rate)) + geom_bar(stat = "identity")

wr_plot +
   scale_x_discrete() +
  scale_y_continuous(expand = c(0, 0), labels = percent, breaks = c(0,0.2, 0.4, 0.6, 0.8, 1), limit = c(0,1)) +
  ggtitle("Win rate by Franchise") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Franchise Name", y = "Win Rate in 2015")


```



Nybria 
```{r}
library(knitr)
bb <- dbConnect_scidb(dbname = "lahman")

fame.players <- bb %>%
dbGetQuery("SELECT DISTINCT s.yearID, s.teamID, s.playerID, s.salary, tf.franchID, tf.franchName, tf.active,
t.teamID, t.franchID, hf.playerID, hf.inducted, hf.category, t.rank
FROM lahman.HallOfFame hf 
JOIN lahman.Salaries  s ON hf.playerID = s.playerID 
JOIN lahman.Teams t ON s.teamID = t.teamID 
JOIN lahman.TeamsFranchises  tf ON t.franchID = tf.franchID
WHERE hf.category = 'Player' AND s.yearID >= 2010 AND tf.active = 'Y' AND hf.inducted = 'Y' GROUP BY s.playerID;
")

players <- bb %>%
dbGetQuery("SELECT DISTINCT s.yearID, s.teamID, s.playerID, s.salary, tf.franchID, tf.franchName, tf.active,
t.teamID, t.franchID, hf.playerID, hf.inducted, hf.category, t.rank
FROM lahman.HallOfFame hf 
JOIN lahman.Salaries  s ON hf.playerID = s.playerID 
JOIN lahman.Teams t ON s.teamID = t.teamID 
JOIN lahman.TeamsFranchises  tf ON t.franchID = tf.franchID
WHERE hf.category = 'Player' AND s.yearID >= 2010 AND tf.active = 'Y' AND hf.inducted = 'N' 
GROUP BY hf.playerID;
")

```

```{r}
library(tidyverse)
library(knitr)
library(kableExtra)


kable(head(fame.players[, 1:7]), format = "html", digits = 2, caption = "Hall of Fame: Inducted Players Between 2010-2017") %>%
  kable_styling(bootstrap_options = "striped", full_width = F)


kable(players[, 1:7], format = "html", digits = 2, caption = "Hall of Fame: Non-inducted Players Between 2010-2017") %>%
  kable_styling(bootstrap_options = "striped", full_width = F)


```



Julia
--------------------------------------------------------
This project would not have been possible without github [^1].

##Links: 
[^1]: [Link to our GitHub Repositoury](https://github.com/christine-chu/MP4)